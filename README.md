# Микросервис для скачивания файлов

Микросервис помогает работе основного сайта, сделанного на CMS и обслуживает
запросы на скачивание архивов с файлами. Микросервис не умеет ничего, кроме упаковки файлов
в архив. Закачиваются файлы на сервер через FTP или админку CMS.

Создание архива происходит на лету по запросу от пользователя. Архив не сохраняется на диске, вместо этого по мере упаковки он сразу отправляется пользователю на скачивание.

От неавторизованного доступа архив защищен хешом в адресе ссылки на скачивание, например: `http://host.ru/archive/3bea29ccabbbf64bdebcc055319c5745/`. Хеш задается названием каталога с файлами, выглядит структура каталога так:

```
- photos
    - 3bea29ccabbbf64bdebcc055319c5745
      - 1.jpg
      - 2.jpg
      - 3.jpg
    - af1ad8c76fda2e48ea9aed2937e972ea
      - 1.jpg
      - 2.jpg
```


## Как установить

Для работы микросервиса нужен Python версии не ниже 3.6.

```bash
pip install -r requirements.txt
```

## Как запустить

```bash
python server.py
```

Сервер запустится на порту 8080, чтобы проверить его работу перейдите в браузере на страницу [http://127.0.0.1:8080/](http://127.0.0.1:8080/).

Серверу можно передать дополнительные параметры через коммандную строку либо через переменные окружения.

Список переменных окружения:

| Переменная окружения | Тип | Описание |
|---|---|---|
| SLOWDOWN | Bool | Позволяет искусственно создать задержку при загрузке файлов|
| MEDIA_DIR | String | Путь до хранилища |
| LOGGING | String | Принимает значения ON или OFF. Если значение OFF, будут включены логи только ошибок!|

Эти же параметры можно задать через аргументы командной строки:

```
$> python server.py -h
usage: server.py [-h] [-d {OFF,ON}] [-s] [-m MEDIA]

Microservice for streaming files.

optional arguments:
  -h, --help            show this help message and exit
  -d {OFF,ON}, --debug {OFF,ON}
                        Show logs.OFF - show only ErrorsON - show all logs
  -s, --slowdown        Slow down file downloads
  -m MEDIA, --media MEDIA
                        Change default media directory
```

## Как развернуть на сервере

```bash
python server.py
```

После этого перенаправить на микросервис запросы, начинающиеся с `/archive/`. Например:

```
GET http://host.ru/archive/3bea29ccabbbf64bdebcc055319c5745/
GET http://host.ru/archive/af1ad8c76fda2e48ea9aed2937e972ea/
```

# Цели проекта

Код написан в рамках прохождения обучающего курса по Python и веб-разработке на сайте [Devman](https://dvmn.org).